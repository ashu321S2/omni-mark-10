<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Login</title>
  <style>
    body{font-family:system-ui,Arial;margin:32px}
    input,button{display:block;padding:8px;margin:8px 0;width:320px}
    .message{color:#b00020}
    .ok{color:#0b7a3f}
    .links{margin-top:10px}
  </style>
</head>
<body>
  <h2>Login</h2>

  <input id="username" placeholder="Username" />
  <input id="password" type="password" placeholder="Password" />
  <button id="btnLogin" type="button">Login</button>

  <p id="loginMessage" class="message"></p>
  <p id="loginOk" class="ok"></p>

  <div class="links">
    <p>Don't have an account? <a href="register.html">Register here</a></p>
  </div>

  <script>
    // minimal login wiring â€” if you already have login.js keep using that
    const API_BASE = "/api";
    document.getElementById('btnLogin').addEventListener('click', async () => {
      const msgEl = document.getElementById('loginMessage');
      msgEl.textContent = '';
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!username || !password) { msgEl.textContent = 'Enter username & password'; return; }
      try {
        const res = await fetch(API_BASE + '/auth/login', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ username, password })
        });
        const text = await res.text();
        let body; try { body = JSON.parse(text); } catch(e){ body = text; }
        if (!res.ok) { msgEl.textContent = (body?.message || body?.error || 'Login failed'); return; }
        const token = body.accessToken || body.token || body.jwt || body.access_token;
        if (!token) { msgEl.textContent = 'Login succeeded but no token returned'; return; }
        localStorage.setItem('accessToken', token);
        window.location.href = '/posts.html';
      } catch (e) {
        console.error('Login error', e);
        msgEl.textContent = 'Network/CORS error';
      }
    });
  </script>
</body>
</html>
